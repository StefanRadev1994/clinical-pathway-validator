<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–ª–∏–Ω–∏—á–Ω–∞ –ü—ä—Ç–µ–∫–∞ ‚Äî –í–∞–ª–∏–¥–∞—Ç–æ—Ä</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #f0f2f5; --card: #ffffff; --primary: #1a56db; --primary-dark: #1642a8;
      --text: #1e293b; --text-muted: #64748b; --border: #dde2e9;
      --green: #16a34a; --green-bg: #ecfdf5; --green-border: #86efac;
      --red: #dc2626; --red-bg: #fef2f2; --red-border: #fca5a5;
      --amber-bg: #fffbeb; --amber-border: #fcd34d; --amber-text: #92400e;
      --orange: #ea580c; --orange-bg: #fff7ed; --orange-border: #fdba74;
      --radius: 14px; --shadow: 0 4px 24px rgba(0,0,0,0.07);
    }
    body {
      font-family: 'IBM Plex Sans', sans-serif; background: var(--bg);
      color: var(--text); min-height: 100vh; padding: 24px 16px;
      -webkit-font-smoothing: antialiased;
    }
    .container { max-width: 660px; margin: 0 auto; }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1a56db 0%, #3730a3 100%);
      border-radius: var(--radius) var(--radius) 0 0;
      padding: 24px 28px; display: flex; align-items: center; gap: 14px;
      box-shadow: var(--shadow);
    }
    .header-icon {
      width: 46px; height: 46px; background: rgba(255,255,255,0.15);
      border-radius: 12px; display: flex; align-items: center; justify-content: center;
      font-size: 22px; flex-shrink: 0;
    }
    .header h1 { font-size: 20px; font-weight: 800; color: #fff; letter-spacing: -0.3px; }
    .header p { font-size: 12px; color: rgba(200,215,255,0.85); margin-top: 3px; }

    /* Card */
    .card {
      background: var(--card); border-radius: 0 0 var(--radius) var(--radius);
      padding: 28px; box-shadow: var(--shadow);
    }
    label { display: block; font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 6px; }
    select, textarea {
      width: 100%; border: 1.5px solid var(--border); border-radius: 10px;
      padding: 12px 14px; font-family: 'IBM Plex Sans', sans-serif;
      font-size: 14px; color: var(--text); background: #fff; outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    select:focus, textarea:focus {
      border-color: var(--primary); box-shadow: 0 0 0 3px rgba(26,86,219,0.12);
    }
    textarea {
      font-family: 'JetBrains Mono', monospace; font-size: 12.5px;
      height: 200px; resize: vertical; line-height: 1.6;
    }
    textarea::placeholder { color: #a0aec0; }
    .field + .field { margin-top: 18px; }

    /* Button */
    .btn-check {
      width: 100%; margin-top: 22px; padding: 14px;
      font-family: 'IBM Plex Sans', sans-serif;
      font-size: 15px; font-weight: 700; color: #fff;
      background: var(--primary); border: none; border-radius: 12px;
      cursor: pointer; transition: background 0.2s, transform 0.1s;
      box-shadow: 0 2px 8px rgba(26,86,219,0.25);
    }
    .btn-check:hover { background: var(--primary-dark); }
    .btn-check:active { transform: scale(0.985); }
    .btn-check:disabled { background: #cbd5e1; cursor: not-allowed; box-shadow: none; }

    /* Results */
    .results { margin-top: 24px; }
    .progress-header {
      display: flex; justify-content: space-between;
      font-size: 12px; font-weight: 500; color: var(--text-muted); margin-bottom: 5px;
    }
    .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 99px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 99px; transition: width 0.7s cubic-bezier(0.4,0,0.2,1); }
    .progress-fill.green { background: var(--green); }
    .progress-fill.yellow { background: #eab308; }
    .progress-fill.red { background: var(--red); }

    /* Banners */
    .banner {
      margin-top: 18px; border-radius: 16px; padding: 36px 20px;
      text-align: center; border-width: 2px; border-style: solid;
      animation: bannerIn 0.4s ease;
    }
    @keyframes bannerIn {
      from { opacity: 0; transform: translateY(12px) scale(0.97); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    .banner-success { background: var(--green-bg); border-color: var(--green-border); }
    .banner-fail { background: var(--red-bg); border-color: var(--red-border); }
    .banner-icon { font-size: 60px; margin-bottom: 8px; }
    .banner h2 { font-size: 28px; font-weight: 800; letter-spacing: -0.5px; }
    .banner-success h2 { color: var(--green); }
    .banner-fail h2 { color: var(--red); }
    .banner .sub { margin-top: 6px; font-size: 14px; font-weight: 500; }
    .banner-success .sub { color: #15803d; }
    .banner-fail .sub { color: #b91c1c; }

    .missing-tags { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 16px; }
    .tag {
      display: inline-flex; align-items: center; gap: 5px;
      background: #fee2e2; color: #991b1b; border: 1px solid #fecaca;
      padding: 5px 12px; border-radius: 99px; font-size: 13px; font-weight: 600;
    }
    .tag-group {
      background: #fef3c7; color: #92400e; border-color: #fde68a;
    }

    /* Warning box */
    .warning-box {
      margin-top: 18px; background: var(--amber-bg); border: 1.5px solid var(--amber-border);
      border-radius: 12px; padding: 14px 18px; text-align: center;
      color: var(--amber-text); font-weight: 500; font-size: 14px;
    }

    /* Special warning banner (for –ê–ü 13 prescription reminder) */
    .warning-banner {
      margin-top: 14px; background: var(--orange-bg);
      border: 2px solid var(--orange-border); border-radius: 14px;
      padding: 18px 22px; text-align: center;
      animation: pulse 1.5s ease-in-out infinite alternate;
    }
    @keyframes pulse {
      from { box-shadow: 0 0 0 0 rgba(234,88,12,0.2); }
      to { box-shadow: 0 0 0 8px rgba(234,88,12,0); }
    }
    .warning-banner-text {
      font-size: 16px; font-weight: 800; color: var(--orange);
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }

    /* Details */
    .details-toggle {
      margin-top: 16px; background: none; border: none;
      font-family: 'IBM Plex Sans', sans-serif;
      font-size: 13px; font-weight: 600; color: var(--primary);
      cursor: pointer; display: flex; align-items: center; gap: 6px; padding: 0;
    }
    .details-toggle:hover { color: var(--primary-dark); }
    .details-grid {
      margin-top: 12px; display: grid; grid-template-columns: 1fr 1fr;
      gap: 6px; max-height: 400px; overflow-y: auto; animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .detail-item {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 8px; font-size: 13px;
    }
    .detail-item.found { background: var(--green-bg); color: #166534; }
    .detail-item.missing { background: var(--red-bg); color: #991b1b; font-weight: 600; }
    .detail-item.group-header {
      grid-column: 1 / -1; background: #f1f5f9; color: #475569;
      font-weight: 700; font-size: 12px; text-transform: uppercase;
      letter-spacing: 0.5px; padding: 6px 12px; margin-top: 6px;
    }
    .detail-item.group-ok { background: #ecfdf5; color: #166534; }
    .detail-item.group-fail { background: #fef2f2; color: #991b1b; font-weight: 600; }
    .detail-icon { flex-shrink: 0; }

    @media (max-width: 500px) {
      .details-grid { grid-template-columns: 1fr; }
      .banner h2 { font-size: 22px; }
      .banner-icon { font-size: 48px; }
    }
    .footer { text-align: center; font-size: 11px; color: #a0aec0; margin-top: 18px; }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="header-icon">üè•</div>
    <div>
      <h1>–ö–ª–∏–Ω–∏—á–Ω–∞ –ü—ä—Ç–µ–∫–∞ ‚Äî –í–∞–ª–∏–¥–∞—Ç–æ—Ä</h1>
      <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–∞ –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–∏—è</p>
    </div>
  </div>

  <div class="card">
    <div class="field">
      <label for="pathway">–ö–ª–∏–Ω–∏—á–Ω–∞ –ø—ä—Ç–µ–∫–∞:</label>
      <select id="pathway">
        <option value="">‚Äî –ò–∑–±–µ—Ä–µ—Ç–µ –∫–ª–∏–Ω–∏—á–Ω–∞ –ø—ä—Ç–µ–∫–∞ ‚Äî</option>
        <option value="–ê–ü 13">–ê–ü 13</option>
        <option value="–ê–ü 14">–ê–ü 14 (–æ—á–∞–∫–≤–∞–π—Ç–µ —Å–∫–æ—Ä–æ)</option>
        <option value="–ê–ü 15">–ê–ü 15 (–æ—á–∞–∫–≤–∞–π—Ç–µ —Å–∫–æ—Ä–æ)</option>
        <option value="–ö–ü 78.1">–ö–ü 78.1</option>
        <option value="–ö–ü 79.1">–ö–ü 79.1</option>
        <option value="–ö–ü 80.1">–ö–ü 80.1</option>
        <option value="–ö–ü 81.1">–ö–ü 81.1</option>
      </select>
    </div>
    <div class="field">
      <label for="inputText">–¢–µ–∫—Å—Ç –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞:</label>
      <textarea id="inputText" placeholder="–ü–æ—Å—Ç–∞–≤–µ—Ç–µ —Ç–µ–∫—Å—Ç–∞ —Å —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç –∏–∑—Å–ª–µ–¥–≤–∞–Ω–∏—è —Ç—É–∫..."></textarea>
    </div>
    <div style="display:flex;gap:10px;margin-top:22px;">
  <button class="btn-check" id="checkBtn" disabled style="margin-top:0;">üîç –ü—Ä–æ–≤–µ—Ä–∏</button>
  <button class="btn-check" id="resetBtn" style="margin-top:0;background:#64748b;box-shadow:0 2px 8px rgba(100,116,139,0.25);flex:0 0 auto;width:52px;padding:14px 0;" title="–ò–∑—á–∏—Å—Ç–∏">üîÑ</button>
</div>
    <div id="results" class="results"></div>
  </div>
  <p class="footer">–ö–ª–∏–Ω–∏—á–Ω–∞ –ü—ä—Ç–µ–∫–∞ –í–∞–ª–∏–¥–∞—Ç–æ—Ä by Stefan Radev</p>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function matchSingle(text, kw) {
  if (kw.alternatives) return kw.alternatives.some(function(a) { return text.indexOf(a) !== -1; });
  if (kw.regex) return kw.regex.test(text);
  return text.indexOf(kw.search) !== -1;
}

// ‚îÄ‚îÄ Shared keyword sets ‚îÄ‚îÄ
var BLOOD_COUNT = [
  { label: "–õ–µ–≤–∫–æ—Ü–∏—Ç–∏", search: "–õ–µ–≤–∫–æ—Ü–∏—Ç–∏" },
  { label: "–•–µ–º–æ–≥–ª–æ–±–∏–Ω", search: "–•–µ–º–æ–≥–ª–æ–±–∏–Ω" },
  { label: "–ï—Ä–∏—Ç—Ä–æ—Ü–∏—Ç–∏", search: "–ï—Ä–∏—Ç—Ä–æ—Ü–∏—Ç–∏" },
  { label: "–•–µ–º–∞—Ç–æ–∫—Ä–∏—Ç", search: "–•–µ–º–∞—Ç–æ–∫—Ä–∏—Ç" },
  { label: "MCV", regex: /\bMCV\b/ },
  { label: "MCH", regex: /\bMCH\b/ },
  { label: "MCHC", regex: /\bMCHC\b/ },
  { label: "–¢—Ä–æ–º–±–æ—Ü–∏—Ç–∏", search: "–¢—Ä–æ–º–±–æ—Ü–∏—Ç–∏" }
];

var THYROID_PANEL = [
  { label: "FT4", regex: /\bFT4\b/ },
  { label: "TSH", regex: /\bTSH\b/ },
  { label: "Anti TG (TAT)", search: "Anti TG" },
  { label: "Anti-TPO (MAT)", search: "Anti-TPO" }
];

var UZD_SHIA = { label: "–£–ó–î –Ω–∞ —à–∏—è / –ï—Ö–æ–≥—Ä–∞—Ñ–∏—è –Ω–∞ —à–∏—è", alternatives: ["–£–ó–î –Ω–∞ —à–∏—è", "–ï–•–û–ì–†–ê–§–ò–Ø –ù–ê –®–ò–Ø", "–ï—Ö–æ–≥—Ä–∞—Ñ–∏—è –Ω–∞ —à–∏—è", "–µ—Ö–æ–≥—Ä–∞—Ñ–∏—è –Ω–∞ —à–∏—è"] };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PATHWAY DEFINITIONS
//  Each pathway returns: { items, warnings }
//  item = { label, found, type }
//    type: "required" | "oneOf" | "group-header" | "conditional-info"
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function checkPathway(pathway, text) {
  switch (pathway) {
    case "–ö–ü 78.1": return checkKP78(text);
    case "–ö–ü 79.1": return checkKP79(text);
    case "–ö–ü 80.1": return checkKP80(text);
    case "–ö–ü 81.1": return checkKP81(text);
    case "–ê–ü 13":   return checkAP13(text);
    default: return null;
  }
}

// ‚îÄ‚îÄ –ö–ü 78.1 ‚îÄ‚îÄ
function checkKP78(text) {
  var items = [];
  // Blood count
  BLOOD_COUNT.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  // Biochemistry
  var biochem = [
    { label: "ASAT", regex: /\bASAT\b/ },
    { label: "ALAT", regex: /\bALAT\b/ },
    { label: "GGT", regex: /\bGGT\b/ },
    { label: "–ê–ª–∫–∞–ª–Ω–∞ —Ñ–æ—Å—Ñ–∞—Ç–∞–∑–∞ / –ê–§", alternatives: ["–ê–ª–∫–∞–ª–Ω–∞ —Ñ–æ—Å—Ñ–∞—Ç–∞–∑–∞", "–ê–§"] },
    { label: "–•–æ–ª–µ—Å—Ç–µ—Ä–æ–ª", search: "–•–æ–ª–µ—Å—Ç–µ—Ä–æ–ª" },
    { label: "HDL", regex: /\bHDL\b/ },
    { label: "LDL", regex: /\bLDL\b/ },
    { label: "–¢—Ä–∏–≥–ª–∏—Ü–µ—Ä–∏–¥–∏", search: "–¢—Ä–∏–≥–ª–∏—Ü–µ—Ä–∏–¥–∏" },
    { label: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω - —Å–µ—Ä—É–º", search: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω - —Å–µ—Ä—É–º" },
    { label: "–£—Ä–µ—è", search: "–£—Ä–µ—è" },
    { label: "–ì–ª–∏–∫–∏—Ä–∞–Ω —Ö–µ–º–æ–≥–ª–æ–±–∏–Ω", search: "–ì–ª–∏–∫–∏—Ä–∞–Ω —Ö–µ–º–æ–≥–ª–æ–±–∏–Ω" },
    { label: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω–æ–≤ –∫–ª–∏—Ä—ä–Ω—Å / eGFR", alternatives: ["—Ä–µ–∞—Ç–∏–Ω–∏–Ω–æ–≤ –∫–ª–∏—Ä—ä–Ω—Å", "eGFR"] }
  ];
  biochem.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  // Glucose profile
  var glucose = [
    { label: "–ì–ª—é–∫–æ–∑–∞ - –ø—Ä–æ—Ñ–∏–ª 6—á", search: "–ì–ª—é–∫–æ–∑–∞ - –ø—Ä–æ—Ñ–∏–ª 6—á" },
    { label: "–ì–ª—é–∫–æ–∑–∞ - –ø—Ä–æ—Ñ–∏–ª 12—á", search: "–ì–ª—é–∫–æ–∑–∞ - –ø—Ä–æ—Ñ–∏–ª 12—á" },
    { label: "–ì–ª—é–∫–æ–∑–∞ - –ø—Ä–æ—Ñ–∏–ª 18—á", search: "–ì–ª—é–∫–æ–∑–∞ - –ø—Ä–æ—Ñ–∏–ª 18—á" }
  ];
  glucose.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  // Urine test strip
  var urineStrip = [
    { label: "–°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ —Ç–µ–≥–ª–æ - —É—Ä–∏–Ω–∞", search: "–°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ —Ç–µ–≥–ª–æ - —É—Ä–∏–Ω–∞" },
    { label: "–£—Ä–∏–Ω–∞ - –º–∏–∫—Ä–æ–∞–ª–±—É–º–∏–Ω", search: "–£—Ä–∏–Ω–∞ - –º–∏–∫—Ä–æ–∞–ª–±—É–º–∏–Ω" },
    { label: "–£—Ä–∏–Ω–∞ - –∞—Å–∫–æ—Ä–±–∏–Ω–æ–≤–∞ –∫-–Ω–∞", search: "–∞—Å–∫–æ—Ä–±–∏–Ω–æ–≤–∞ –∫-–Ω–∞" },
    { label: "pH - —É—Ä–∏–Ω–∞", search: "pH - —É—Ä–∏–Ω–∞" },
    { label: "–ë–µ–ª—Ç—ä–∫ - —É—Ä–∏–Ω–∞", search: "–ë–µ–ª—Ç—ä–∫ - —É—Ä–∏–Ω–∞" },
    { label: "–ì–ª—é–∫–æ–∑–∞ - —É—Ä–∏–Ω–∞", search: "–ì–ª—é–∫–æ–∑–∞ - —É—Ä–∏–Ω–∞" },
    { label: "–ö–µ—Ç–æ—Ç–µ–ª–∞ - —É—Ä–∏–Ω–∞", search: "–ö–µ—Ç–æ—Ç–µ–ª–∞ - —É—Ä–∏–Ω–∞" },
    { label: "–ë–∏–ª–∏—Ä—É–±–∏–Ω - —É—Ä–∏–Ω–∞", search: "–ë–∏–ª–∏—Ä—É–±–∏–Ω - —É—Ä–∏–Ω–∞" },
    { label: "–£—Ä–æ–±–∏–ª–∏–Ω–æ–≥–µ–Ω - —É—Ä–∏–Ω–∞", search: "–£—Ä–æ–±–∏–ª–∏–Ω–æ–≥–µ–Ω - —É—Ä–∏–Ω–∞" },
    { label: "–ù–∏—Ç—Ä–∏—Ç–∏ - —É—Ä–∏–Ω–∞", search: "–ù–∏—Ç—Ä–∏—Ç–∏ - —É—Ä–∏–Ω–∞" },
    { label: "–ö—Ä—ä–≤ - —É—Ä–∏–Ω–∞", search: "–ö—Ä—ä–≤ - —É—Ä–∏–Ω–∞" },
    { label: "–£—Ä–∏–Ω–∞ - –ª–µ–≤–∫–æ—Ü–∏—Ç–∏", search: "–£—Ä–∏–Ω–∞ - –ª–µ–≤–∫–æ—Ü–∏—Ç–∏" }
  ];
  urineStrip.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  // Sediment
  var sediment = [
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - –ï–†–ò–¢–†–û–¶–ò–¢–ò", search: "–°–µ–¥–∏–º–µ–Ω—Ç —É—Ä–∏–Ω–∞ - –ï–†–ò–¢–†–û–¶–ò–¢–ò" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - –õ–ï–í–ö–û–¶–ò–¢–ò", search: "–°–µ–¥–∏–º–µ–Ω—Ç —É—Ä–∏–Ω–∞ - –õ–ï–í–ö–û–¶–ò–¢–ò" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - –≥—Ä—É–ø–∏—Ä–∞–Ω–∏ –ª–µ–≤–∫–æ—Ü–∏—Ç–∏", search: "–≥—Ä—É–ø–∏—Ä–∞–Ω–∏ –ª–µ–≤–∫–æ—Ü–∏—Ç–∏" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - —Å–∫–≤–∞–º–æ–∑–Ω–∏ –µ–ø. –∫–ª–µ—Ç–∫–∏", search: "—Å–∫–≤–∞–º–æ–∑–Ω–∏" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - –ù–ï—Å–∫–≤–∞–º–æ–∑–Ω–∏ –µ–ø. –∫–ª–µ—Ç–∫–∏", search: "–ù–ï—Å–∫–≤–∞–º–æ–∑–Ω–∏" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - –±–∞–∫—Ç–µ—Ä–∏–∏", search: "–°–µ–¥–∏–º–µ–Ω—Ç —É—Ä–∏–Ω–∞ - –±–∞–∫—Ç–µ—Ä–∏–∏" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - –∫—Ä–∏—Å—Ç–∞–ª–∏", search: "–°–µ–¥–∏–º–µ–Ω—Ç —É—Ä–∏–Ω–∞ - –∫—Ä–∏—Å—Ç–∞–ª–∏" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - –°–õ–£–ó", search: "–°–µ–¥–∏–º–µ–Ω—Ç —É—Ä–∏–Ω–∞ - –°–õ–£–ó" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - —Ö–∏–∞–ª–∏–Ω–Ω–∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏", search: "—Ö–∏–∞–ª–∏–Ω–Ω–∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - –ù–ï—Ö–∏–∞–ª–∏–Ω–Ω–∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏", search: "–ù–ï—Ö–∏–∞–ª–∏–Ω–Ω–∏ —Ü–∏–ª–∏–Ω–¥—Ä–∏" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - –≥—ä–±–∏—á–∫–∏ (Candida)", search: "Candida" },
    { label: "–°–µ–¥–∏–º–µ–Ω—Ç - —Å–ø–µ—Ä–º–∞—Ç–æ–∑–æ–∏–¥–∏", search: "—Å–ø–µ—Ä–º–∞—Ç–æ–∑–æ–∏–¥–∏" }
  ];
  sediment.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  // Albumin/Creatinine urine
  var albCr = [
    { label: "–ê–ª–±—É–º–∏–Ω –≤ —É—Ä–∏–Ω–∞", search: "–ê–ª–±—É–º–∏–Ω –≤ —É—Ä–∏–Ω–∞" },
    { label: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω - —É—Ä–∏–Ω–∞", search: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω - —É—Ä–∏–Ω–∞" },
    { label: "–û—Ç–Ω–æ—à–µ–Ω–∏–µ –∞–ª–±—É–º–∏–Ω/–∫—Ä–µ–∞—Ç–∏–Ω–∏–Ω (AKR)", search: "AKR" }
  ];
  albCr.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  // ECG
  items.push({ label: "–ï–ö–ì", found: /\b–ï–ö–ì\b/.test(text), type: "required" });

  return { items: items, warnings: [] };
}

// ‚îÄ‚îÄ –ö–ü 79.1 ‚îÄ‚îÄ
function checkKP79(text) {
  var items = [];
  BLOOD_COUNT.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  THYROID_PANEL.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  items.push({ label: UZD_SHIA.label, found: matchSingle(text, UZD_SHIA), type: "required" });
  return { items: items, warnings: [] };
}

// ‚îÄ‚îÄ –ö–ü 80.1 ‚îÄ‚îÄ
function checkKP80(text) {
  var items = [];
  // Blood count
  BLOOD_COUNT.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });

  // At least ONE hormone
  var hormones = [
    { label: "FT4", regex: /\bFT4\b/ },
    { label: "–ö–æ—Ä—Ç–∏–∑–æ–ª - —Å–µ—Ä—É–º", search: "–ö–æ—Ä—Ç–∏–∑–æ–ª" },
    { label: "LH", regex: /\bLH\b/ },
    { label: "FSH", regex: /\bFSH\b/ },
    { label: "–ï—Å—Ç—Ä–∞–¥–∏–æ–ª", search: "–ï—Å—Ç—Ä–∞–¥–∏–æ–ª" },
    { label: "–¢–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω", alternatives: ["Testosteron", "–¢–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω"] },
    { label: "GH / –†–∞—Å—Ç–µ–∂–µ–Ω —Ö–æ—Ä–º–æ–Ω", alternatives: ["GH", "–†–∞—Å—Ç–µ–∂–µ–Ω —Ö–æ—Ä–º–æ–Ω"] },
    { label: "IGF1", regex: /\bIGF1\b|IGF-1/ },
    { label: "–ê–ö–¢–•", alternatives: ["AKTH", "–ê–ö–¢–•"] },
    { label: "TSH / –¢–°–•", alternatives: ["TSH", "–¢–°–•"] },
    { label: "–ü—Ä–æ–ª–∞–∫—Ç–∏–Ω", alternatives: ["Prolactin", "–ü—Ä–æ–ª–∞–∫—Ç–∏–Ω"] }
  ];
  var hormoneFound = hormones.some(function(kw) { return matchSingle(text, kw); });
  var hormoneLabels = hormones.map(function(h) { return h.label; }).join(", ");
  items.push({
    label: "–ü–æ–Ω–µ 1 —Ö–æ—Ä–º–æ–Ω (" + hormoneLabels + ")",
    found: hormoneFound,
    type: "oneOf",
    subItems: hormones.map(function(kw) { return { label: kw.label, found: matchSingle(text, kw) }; })
  });

  // –ö–æ—Ä—Ç–∏–∑–æ–ª —É—Ä–∏–Ω–∞ 24—á
  items.push({ label: "–ö–æ—Ä—Ç–∏–∑–æ–ª - —É—Ä–∏–Ω–∞ 24—á", found: text.indexOf("–ö–æ—Ä—Ç–∏–∑–æ–ª") !== -1 && text.indexOf("—É—Ä–∏–Ω–∞") !== -1, type: "required" });

  // At least ONE imaging study
  var imaging = [
    { label: "–£–ó–î –Ω–∞ —à–∏—è / –ï—Ö–æ–≥—Ä–∞—Ñ–∏—è –Ω–∞ —à–∏—è", alternatives: ["–£–ó–î –Ω–∞ —à–∏—è", "–ï–•–û–ì–†–ê–§–ò–Ø –ù–ê –®–ò–Ø", "–ï—Ö–æ–≥—Ä–∞—Ñ–∏—è –Ω–∞ —à–∏—è", "–µ—Ö–æ–≥—Ä–∞—Ñ–∏—è –Ω–∞ —à–∏—è"] },
    { label: "–•–ò–ü–û–§–ò–ó–ê –ú–†", alternatives: ["–•–ò–ü–û–§–ò–ó–ê –ú–†", "—Ö–∏–ø–æ—Ñ–∏–∑–∞ –º—Ä", "–ú–† –Ω–∞ —Ö–∏–ø–æ—Ñ–∏–∑–∞", "MRI —Ö–∏–ø–æ—Ñ–∏–∑–∞"] },
    { label: "–ö–¢", alternatives: ["KT", "–ö–¢", "–ö–æ–º–ø—é—Ç—ä—Ä–Ω–∞ —Ç–æ–º–æ–≥—Ä–∞—Ñ–∏—è"] },
    { label: "–ï—Ö–æ—Å–∫–æ–ø–∏—è –Ω–∞ –∫–æ—Ä–µ–º–Ω–∏ –æ—Ä–≥–∞–Ω–∏", alternatives: ["–ï—Ö–æ—Å–∫–æ–ø–∏—è –Ω–∞ –∫–æ—Ä–µ–º–Ω–∏ –æ—Ä–≥–∞–Ω–∏", "–µ—Ö–æ—Å–∫–æ–ø–∏—è –Ω–∞ –∫–æ—Ä–µ–º–Ω–∏ –æ—Ä–≥–∞–Ω–∏"] },
    { label: "–†–ï–ù–¢–ì–ï–ù–û–ì–†–ê–§–ò–Ø", alternatives: ["–†–ï–ù–¢–ì–ï–ù–û–ì–†–ê–§–ò–Ø", "–†–µ–Ω—Ç–≥–µ–Ω–æ–≥—Ä–∞—Ñ–∏—è", "—Ä–µ–Ω—Ç–≥–µ–Ω–æ–≥—Ä–∞—Ñ–∏—è", "–†–µ–Ω—Ç–≥–µ–Ω–æ–≥—Ä–∞—Ñ"] }
  ];
  var imagingFound = imaging.some(function(kw) { return matchSingle(text, kw); });
  items.push({
    label: "–ü–æ–Ω–µ 1 –æ–±—Ä–∞–∑–Ω–æ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–µ",
    found: imagingFound,
    type: "oneOf",
    subItems: imaging.map(function(kw) { return { label: kw.label, found: matchSingle(text, kw) }; })
  });

  return { items: items, warnings: [] };
}

// ‚îÄ‚îÄ –ö–ü 81.1 ‚îÄ‚îÄ
function checkKP81(text) {
  var items = [];
  BLOOD_COUNT.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  var kp81 = [
    { label: "ASAT", regex: /\bASAT\b/ },
    { label: "ALAT", regex: /\bALAT\b/ },
    { label: "GGT", regex: /\bGGT\b/ },
    { label: "–ê–ª–∫–∞–ª–Ω–∞ —Ñ–æ—Å—Ñ–∞—Ç–∞–∑–∞", search: "–ê–ª–∫–∞–ª–Ω–∞ —Ñ–æ—Å—Ñ–∞—Ç–∞–∑–∞" },
    { label: "–•–æ–ª–µ—Å—Ç–µ—Ä–æ–ª", search: "–•–æ–ª–µ—Å—Ç–µ—Ä–æ–ª" },
    { label: "HDL", regex: /\bHDL\b/ },
    { label: "LDL", regex: /\bLDL\b/ },
    { label: "–¢—Ä–∏–≥–ª–∏—Ü–µ—Ä–∏–¥–∏", search: "–¢—Ä–∏–≥–ª–∏—Ü–µ—Ä–∏–¥–∏" },
    { label: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω - —Å–µ—Ä—É–º", search: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω - —Å–µ—Ä—É–º" },
    { label: "–£—Ä–µ—è", search: "–£—Ä–µ—è" },
    { label: "cCa++", regex: /cCa/ },
    { label: "–ö–∞–ª—Ü–∏–π", search: "–ö–∞–ª—Ü–∏–π" },
    { label: "–ù–µ–æ—Ä–≥–∞–Ω–∏—á–µ–Ω —Ñ–æ—Å—Ñ–∞—Ç", search: "–ù–µ–æ—Ä–≥–∞–Ω–∏—á–µ–Ω —Ñ–æ—Å—Ñ–∞—Ç" },
    { label: "Mg", regex: /\bMg\b/ },
    { label: "–ù–∞—Ç—Ä–∏–π", search: "–ù–∞—Ç—Ä–∏–π" },
    { label: "–ö–∞–ª–∏–π", search: "–ö–∞–ª–∏–π" },
    { label: "–•–ª–æ—Ä–∏–¥", search: "–•–ª–æ—Ä–∏–¥" },
    { label: "PTH", regex: /\bPTH\b/ },
    { label: "25 OH Vitamin D TOTAL", search: "25 OH Vitamin D" },
    { label: "Beta Cross Laps", search: "Beta Cross Laps" },
    { label: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω–æ–≤ –∫–ª–∏—Ä—ä–Ω—Å", search: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω–æ–≤ –∫–ª–∏—Ä—ä–Ω—Å" },
    { label: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω - —É—Ä–∏–Ω–∞", search: "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω - —É—Ä–∏–Ω–∞" },
    { label: "–ö–∞–ª—Ü–∏–π 24—á- —É—Ä–∏–Ω–∞", search: "–ö–∞–ª—Ü–∏–π 24—á" },
    { label: "–§–æ—Å—Ñ–æ—Ä 24—á- —É—Ä–∏–Ω–∞", search: "–§–æ—Å—Ñ–æ—Ä 24—á" },
    { label: "–î–∏—É—Ä–µ–∑–∞ (–î-–º–ª)", regex: /–î-\d/ },
    { label: "–û—Å—Ç–µ–æ–º–µ—Ç—Ä–∏—è –Ω–∞ –¥–≤–µ –æ–±–ª–∞—Å—Ç–∏", search: "–û—Å—Ç–µ–æ–º–µ—Ç—Ä–∏—è" },
    { label: "–£–ó–î –Ω–∞ —à–∏—è", search: "–£–ó–î –Ω–∞ —à–∏—è" }
  ];
  kp81.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
  return { items: items, warnings: [] };
}

// ‚îÄ‚îÄ –ê–ü 13 (conditional logic) ‚îÄ‚îÄ
function checkAP13(text) {
  var items = [];
  var warnings = [];

  // Always required: –£–ó–î –Ω–∞ —à–∏—è
  items.push({ label: UZD_SHIA.label, found: matchSingle(text, UZD_SHIA), type: "required" });

  // Check for cytology
  var hasCytology = text.indexOf("–¶–∏—Ç–æ–ª–æ–≥–∏—á–Ω–æ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–µ") !== -1 || text.indexOf("—Ü–∏—Ç–æ–ª–æ–≥–∏—á–Ω–æ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–µ") !== -1 || text.indexOf("—Ç—ä–Ω–∫–æ–∏–≥–ª–µ–Ω–∞ –∞—Å–ø–∏—Ä–∞—Ü–∏–æ–Ω–Ω–∞ –±–∏–æ–ø—Å–∏—è") !== -1 || text.indexOf("–¢–ê–ë") !== -1;

  items.push({ label: "–¶–∏—Ç–æ–ª–æ–≥–∏—á–Ω–æ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–µ / –¢–ê–ë", found: hasCytology, type: "required" });

  if (!hasCytology) {
    // If no cytology ‚Üí need blood count + thyroid panel + warning
    items.push({ label: "‚îÄ‚îÄ –ù—è–º–∞ —Ü–∏—Ç–æ–ª–æ–≥–∏—è ‚Üí –Ω—É–∂–Ω–∏ —Å–∞ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–∏—è ‚îÄ‚îÄ", found: false, type: "conditional-info" });

    BLOOD_COUNT.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });
    THYROID_PANEL.forEach(function(kw) { items.push({ label: kw.label, found: matchSingle(text, kw), type: "required" }); });

    warnings.push("‚ö†Ô∏è –ù–µ –∑–∞–±—Ä–∞–≤—è–π –¥–∞ –∏–∑–ø–∏—à–µ—à –ª–µ—á–µ–±–Ω–æ –≤–µ—â–µ—Å—Ç–≤–æ!!!");
  }

  return { items: items, warnings: warnings };
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UI LOGIC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var CONFIGURED = ["–ê–ü 13", "–ö–ü 78.1", "–ö–ü 79.1", "–ö–ü 80.1", "–ö–ü 81.1"];

var pathwayEl = document.getElementById("pathway");
var inputEl   = document.getElementById("inputText");
var checkBtn  = document.getElementById("checkBtn");
var resultsEl = document.getElementById("results");

function updateBtn() {
  checkBtn.disabled = !pathwayEl.value || !inputEl.value.trim();
}
pathwayEl.addEventListener("change", function() { updateBtn(); resultsEl.innerHTML = ""; });
inputEl.addEventListener("input", function() { updateBtn(); resultsEl.innerHTML = ""; });

checkBtn.addEventListener("click", function() {
  var pathway = pathwayEl.value;
  var text = inputEl.value;

  if (!CONFIGURED.includes(pathway)) {
    resultsEl.innerHTML = '<div class="warning-box">‚ö†Ô∏è –¢–∞–∑–∏ –∫–ª–∏–Ω–∏—á–Ω–∞ –ø—ä—Ç–µ–∫–∞ –≤—Å–µ –æ—â–µ –Ω–µ –µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–∞.</div>';
    return;
  }

  var result = checkPathway(pathway, text);
  if (!result) return;

  var items = result.items;
  var warnings = result.warnings;

  // Count required/oneOf items (skip conditional-info)
  var checkable = items.filter(function(i) { return i.type === "required" || i.type === "oneOf"; });
  var foundCount = checkable.filter(function(i) { return i.found; }).length;
  var totalCount = checkable.length;
  var missingItems = checkable.filter(function(i) { return !i.found; });
  var pct = Math.round((foundCount / totalCount) * 100);
  var barClass = pct === 100 ? "green" : pct > 60 ? "yellow" : "red";

  var html = '<div class="progress-header">' +
    '<span>–ù–∞–º–µ—Ä–µ–Ω–∏: ' + foundCount + ' / ' + totalCount + '</span>' +
    '<span>' + pct + '%</span></div>' +
    '<div class="progress-bar"><div class="progress-fill ' + barClass + '" style="width:' + pct + '%"></div></div>';

  // Banner
  if (missingItems.length === 0) {
    html += '<div class="banner banner-success">' +
      '<div class="banner-icon">‚úÖ</div>' +
      '<h2>Mission complete!</h2>' +
      '<p class="sub">–í—Å–∏—á–∫–∏ ' + totalCount + ' –∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–∏ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–∏—è —Å–∞ –Ω–∞–ª–∏—á–Ω–∏.</p></div>';
  } else {
    var missingText = missingItems.length === 1
      ? '‚Äû' + missingItems[0].label + '" –ª–∏–ø—Å–≤–∞!'
      : missingItems.length + ' –∏–∑—Å–ª–µ–¥–≤–∞–Ω–∏—è –ª–∏–ø—Å–≤–∞—Ç!';
    var tags = missingItems.map(function(m) {
      var cls = m.type === "oneOf" ? "tag tag-group" : "tag";
      return '<span class="' + cls + '">‚ùå ' + m.label + '</span>';
    }).join("");
    html += '<div class="banner banner-fail">' +
      '<div class="banner-icon">‚ö°</div>' +
      '<h2>Stop!</h2>' +
      '<p class="sub">' + missingText + '</p>' +
      '<div class="missing-tags">' + tags + '</div></div>';
  }

  // Warnings (e.g. –ê–ü 13 prescription reminder)
  warnings.forEach(function(w) {
    html += '<div class="warning-banner"><div class="warning-banner-text">üíä ' + w + '</div></div>';
  });

  // Detail items
  var detailItems = items.map(function(r) {
    if (r.type === "conditional-info") {
      return '<div class="detail-item group-header">' + r.label + '</div>';
    }
    if (r.type === "oneOf") {
      var mainCls = r.found ? "found" : "missing";
      var mainIcon = r.found ? "‚úÖ" : "‚ùå";
      var sub = '';
      if (r.subItems) {
        sub = r.subItems.map(function(s) {
          var sCls = s.found ? "group-ok" : "group-fail";
          var sIcon = s.found ? "‚úÖ" : "‚¨ú";
          return '<div class="detail-item ' + sCls + '" style="padding-left:28px;font-size:12px;">' +
            '<span class="detail-icon">' + sIcon + '</span><span>' + s.label + '</span></div>';
        }).join("");
      }
      return '<div class="detail-item ' + mainCls + '" style="grid-column:1/-1;font-weight:700;">' +
        '<span class="detail-icon">' + mainIcon + '</span><span>' + r.label + '</span></div>' + sub;
    }
    var cls = r.found ? "found" : "missing";
    var icon = r.found ? "‚úÖ" : "‚ùå";
    return '<div class="detail-item ' + cls + '">' +
      '<span class="detail-icon">' + icon + '</span><span>' + r.label + '</span></div>';
  }).join("");

  var showGrid = missingItems.length > 0 ? "grid" : "none";
  html += '<button class="details-toggle" onclick="toggleDetails()">' +
    '<span id="detailArrow">' + (missingItems.length > 0 ? '‚ñº' : '‚ñ∂') + '</span> –î–µ—Ç–∞–π–ª–µ–Ω –ø—Ä–µ–≥–ª–µ–¥</button>' +
    '<div class="details-grid" id="detailsGrid" style="display:' + showGrid + '">' +
    detailItems + '</div>';

  resultsEl.innerHTML = html;
});

function toggleDetails() {
  var grid = document.getElementById("detailsGrid");
  var arrow = document.getElementById("detailArrow");
  if (grid.style.display === "none") {
    grid.style.display = "grid";
    arrow.textContent = "‚ñº";
  } else {
    grid.style.display = "none";
    arrow.textContent = "‚ñ∂";
  }
}
</script>
</body>
</html>
